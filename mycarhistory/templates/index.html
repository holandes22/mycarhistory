{% extends 'base.html' %}
{% block page_content %}
{% verbatim %}

<script type="text/x-handlebars" id="cars">
<div class="container">
  <div class="row">
    <div class="col-md-3">
      <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#carAddModal">+ Add Car</button>
      <legend>Cars</legend>
      <ul class="nav nav-pills nav-stacked">
        {{#with model as cars}}
          {{#each car in cars}}
            <li>{{#link-to 'car' car}}{{car.fullName}}{{/link-to}}</li>
            {{#if car.treatments}}
              <li class="dropdown-header">{{#link-to 'treatments' car.id}}Treatments{{/link-to}}</li>
            {{/if}}
          {{/each}}
        {{/with}}
      </ul>
    </div>
    <div class="col-md-9">
      {{partial 'car/add'}}
      {{outlet}}
    </div>
  </div>
</div>
</script>

<script type="text/x-handlebars" id="car">
  <div>
    <div class="row">
      {{partial 'car/edit'}}
      {{partial 'car/delete'}}
      <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#carEditModal">
        Edit
      </button>
      <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#carDeleteModal">
        Delete
      </button>
    </div>
    {{#with model as car}}
    <div class="row">
      <legend>Car Details</legend>
      <table class="table table-striped">
        <tr>
          <th>Brand</th>
          <th>Model</th>
          <th>Year</th>
          <th>Owners</th>
          <th>Automatic?</th>
        </tr>
        <tr>
          <td>{{car.brand}}</td>
          <td>{{car.model}}</td>
          <td>{{car.year}}</td>
          <td>{{car.amountOfOwners}}</td>
          <td>{{car.isAutomatic}}</td>
        </tr>
      </table>
    </div>
    <div class="row">
      {{outlet}}
    </div>
    {{/with}}
  </div>
</script>


<script type="text/x-handlebars" id="treatments">
  <legend>Treatments</legend>
  <ul>
  {{#each model}}
    <li>{{#link-to 'treatment' this}}Treatment done on {{date}}{{/link-to}}</li>
  {{/each}}
  {{outlet}}
  </ul>
</script>

<script type="text/x-handlebars" id="treatment">
  <legend>Treatment Details</legend>
  <table class="table table-stripped table-bordered">
    <tr>
      <th>Done By</th>
      <th>Description</th>
      <th>Date</th>
    </tr>
    <tr>
      <td>{{done_by}}</td>
      <td>{{description}}</td>
      <td>{{date}}</td>
    </tr>
  </table>
</script>


<script type="text/x-handlebars" id="car/_edit">
  <div class="modal fade" id="carEditModal" tabindex="-1" role="dialog" aria-labelledby="carEditModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="carEditModalLabel">Edit {{fullName}} details</h4>
        </div>
        <div class="modal-body">
          {{partial 'carEditForm'}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button {{action 'updateCar' model}} type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</script>

<script type="text/x-handlebars" id="car/_add">
  <div class="modal fade" id="carAddModal" tabindex="-1" role="dialog" aria-labelledby="carAddModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="carAddModalLabel">Add a new car</h4>
        </div>
        <div class="modal-body">
          {{partial 'carEditForm'}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button {{action 'addCar'}} type="button" class="btn btn-primary">Add</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</script>

<script type="text/x-handlebars" id="car/_delete">
  <div class="modal fade" id="carDeleteModal" tabindex="-1" role="dialog" aria-labelledby="carDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="carDeleteModalLabel">Add a new car</h4>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you would like to remove {{fullName}} from your car list?. This will also remove all the
            related treatments.
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button {{action 'deleteCar' model}} type="button" class="btn btn-primary">Delete</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</script>

<script type="text/x-handlebars" id="carEditForm">
    {{#form-for model}}
      {{input brand}}
      {{input model.model label="Model"}}
      {{input kilometrage as="number"}}
      {{input year as="number"}}
      {{input amountOfOwners as="number"}}
      {{input gearboxType as="select"
        collection="App.gearboxTypes"
        selection="gearboxTypes"
        prompt="Select Gearbox Type"
      }}
    {{/form-for}}
</script>

{% endverbatim %}
{% endblock page_content %}
